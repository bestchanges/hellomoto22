{% extends "layout.html" %}

{% block head %}
<script>
$(document).ready(function() {
    var table = $('#datalist').DataTable({
        "ajax": "rigs.json",
        "paging": false,
        "scrollY": 400,
        "select": {
            style:    'os',
            selector: 'td:first-child'
        },
        "columns": [
            { "data": "name" },
            { "data": "online",
                render: function ( data, type, row ) {
                    if (data.is_online) {
                        return 'ON ' + data.uptime
                    } else {
                        return 'OFF'
                    }
                }
            },
            { "data": "miner",
                render: function ( data, type, row ) {
                    if (data.is_run) {
                        return data.configuration_name
                    } else {
                        return '(stopped) ' + data.configuration_name
                    }
                }
            },
            { "data": "profit" },
            { "data": "hashrate" ,
                render: function ( data, type, row ) {
                    result = '';
                    for (var i = 0; i < data.length; i++) {
                        result = result + data[i].value + ' ' + data[i].units + ' ';
                    }
                    return result;
                }
            },
            {
                "targets": -1,
                "data": null,
                "defaultContent": "<button class='edit' title='Edit'>Edit</button> <button class='cl'>Info</button> <button class='o' title='Reboot rig'>R</button>"
            }
        ]
 });

$( "#dialog-confirm" ).dialog({
      resizable: false,
      height: "auto",
      width: 400,
      modal: true,
      autoOpen: false,
      buttons: [
        {
         text: "YES",
         
         classes: {
    "ui-button": "highlight"
  },
  click: function() {
            $( this ).dialog( "close" );
            }
        },
        {
         text: 'Cancel',
         click: function() {
            $( this ).dialog( "close" );
           }
        }
      ]
    });
    
 // https://datatables.net/examples/ajax/null_data_source.html
     $('#datalist tbody').on( 'click', 'button.cl', function () {
        var data = table.row( $(this).parents('tr') ).data();
        alert( data['name'] +"'s info is "+ data['info'] );
    } );

     $('#datalist tbody').on( 'click', 'button.edit', function () {
        var data = table.row( $(this).parents('tr') ).data();
        window.location.href = '/user/rig/' + data['uuid'] + '/info'
    } );

    $('#datalist tbody').on( 'click', 'button.o', function () {
        var data = table.row( $(this).parents('tr') ).data();
        $("#dialog-rig-name").text(data['name']);
        $( "#dialog-confirm" ).dialog("open");
    } );
} );
</script>
{% endblock %}

{% block body %}
<div class=page>
<h1>Workers list</h1>
<table id="datalist" class="display" cellspacing="0" width="800">
        <thead>
            <tr>
                <th>Name</th>
                <th>Status</th>
                <th>Mining</th>
                <th>Profit</th>
                <th>Hashrate</th>
                <th>Action</th>
            </tr>
        </thead>
</table>

<div id="dialog-confirm" title="Reboot confirmation">
  <p><span class="ui-icon ui-icon-alert" style="float:left; margin:12px 12px 20px 0;"></span>Are you shure you want to reboot rig <span id="dialog-rig-name"></span>?</p>
</div>

</div>


{% endblock %}
